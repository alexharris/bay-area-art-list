<!DOCTYPE html>
<html>
  <head>
    <title>Bay Area Art List</title>
    <meta charset="utf-8" />
    <style>
      h2 {
        font-size: 1.1em;
        margin-bottom: 0;
      }
      p {
        margin: 0;
      }
    </style>
    <script src="handlebars.min-v4.7.7.js"></script>    
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>    
  </head>
  <body>
    <h1>Bay Area Art List</h1>
    <div id="content"></div>
    
    
    <script id="template1" type="text/x-handlebars-template">
      <div>
      
      {{#each event}}
        <div>
       
          <h2>{{this.highlight}} {{#if this.artist}}{{this.artist}}{{/if}}{{#if this.event}}{{this.event}}{{/if}}</h2>
          <p>
          {{#if this.location}}
            {{this.location}}<br />
          {{/if}}
          {{#if this.start}}
            {{this.start}}{{#if this.end}} â€“ {{this.end}}{{/if}}<br />
          {{/if}}
          {{#if this.address}}
            {{this.address}}<br />
          {{/if}}
          {{#if this.url}}
            {{this.url}}
          {{/if}}
  
          </p>
        </div>
      {{/each}}
     </div>
    </script>    
    
    

    <!-- From: https://github.com/yesmesalman/fetch-data-from-google-spreadsheet-using-js -->
    <script type="text/javascript">

  
      // Client ID and API key from the Developer Console

      function makeApiCall() {
        var params = {

          // The ID of the spreadsheet to retrieve data from.
          spreadsheetId: '1WkrD2baQodRGnBuFW7ZyZfWYR2vcQOecWVDzCsPp_kg',  // TODO: Update placeholder value.

          // The A1 notation of the values to retrieve.
          range: 'Opening March 2022',  // TODO: Update placeholder value.

        };

      var request = gapi.client.sheets.spreadsheets.values.get(params);
      request.then(function(response) {
        // TODO: Change code below to process the `response` object:
        results = response.result.values
        loadContent(results)
      }, function(reason) {
        console.error('error: ' + reason.result.error.message);
      });
    }

    function initClient() {

      //Add Your API Key here
      var API_KEY = 'AIzaSyCmEpbC5xR6cMHTizSbFq6bHArzYsfgg94';

      //Add Client ID here
      var CLIENT_ID = '394272548399-s34rr5i4oucssr0pgh6r8m07e7msceki.apps.googleusercontent.com';

      var SCOPE = 'https://www.googleapis.com/auth/spreadsheets.readonly';
      gapi.client.init({
        'apiKey': API_KEY,
        'clientId': CLIENT_ID,
        'scope': SCOPE,
        'discoveryDocs': ['https://sheets.googleapis.com/$discovery/rest?version=v4'],
      }).then(function() {
        makeApiCall();
      });
      }

      function handleClientLoad() {
      gapi.load('client:auth2', initClient);
    }    
    
    var jsonData = { 
        event : [] 
    };

    function loadContent(results) {
      i = 0;
      results.forEach(function(element) {
        // 0: "!"
        // 1: "Artist/s"
        // 2: "Show/Event"
        // 3: "Location"
        // 4: "Start date"
        // 5: "End date"
        // 6: "Address"
        // 7: "URL"
        // 8: "Notes"     
        if(i !== 0) {
          jsonData['event'][i] = {
            highlight: element[0],
            artist: element[1],
            // event: element[2],
            location: element[3],
            start: element[4],
            end: element[5],
            address: element[6],
            url: element[7],
            notes: element[8],
          }
          // This section adds a colon if there is both an artist and an event
          console.log(element[1])
          if (element[1] && element[2]){
            console.log('both');
              jsonData['event'][i]['event'] = ': ' + element[2]   
          } else {
            console.log('not both')
            jsonData['event'][i]['event'] = element[2]   
          }
        }
        
        i++;
      } );
      
      putContentIntoHtml()
    }
    
    function putContentIntoHtml() {
    //json data for handlebar template
    var data = jsonData;
    console.log(data)
    //handlebar template html
    var template = $("#template1").html();
    //handlebar's compile method returns special function which can be used to get final html
    var compiledCode = Handlebars.compile(template);
    //json data is passed to compiled code and result will be html
    var result = compiledCode(data);
    //compiled html can be rendered in document
    $("#content").html(result);
      
    }
    
    
    

    

    

    


    </script>

    <script async defer src="https://apis.google.com/js/api.js"
      onload="this.onload=function(){};handleClientLoad()"
      onreadystatechange="if (this.readyState === 'complete') this.onload()">
    </script>
    

  </body>
</html>
